<?php include 'fetch_projects.php'; ?>
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link rel="stylesheet" href="css/task.css" />
	</head>
	<body>
		<div class="sidebar">
			<div class="sidebar-links">
				<div class="logo">
					<img src="img/companylogo.svg" />
					<span>HR HARMONY</span>
				</div>

				<div class="sidebar-item">
					<a href="#"> <img src="img/icons/dashboard.svg" />Dashboard</a>
				</div>

				<div class="sidebar-item">
					<a href="#"><img src="img/icons/tasks.svg" /> Task</a>
				</div>

				<div class="sidebar-item">
					<a href="#"><img src="img/icons/appraisal.svg" /> Appraisal</a>
				</div>

				<div class="sidebar-item">
					<a href="#"> <img src="img/icons/payment.svg" />Payslip</a>
				</div>

				<div class="sidebar-item">
					<a href="#"> <img src="img/icons/training.svg" />Training</a>
				</div>

				<div class="sidebar-item">
					<a href="#"><img src="img/icons/account.svg" /> Account</a>
				</div>

				<div class="sidebar-item">
					<a href="#"> <img src="img/icons/exit.svg" />Logout</a>
				</div>
			</div>
		</div>

		<div class="main">
			<div class="header">
				<h1>HR HARMONY</h1>
				<div class="searchbar">
					<input type="search" placeholder="Search..." />
					<img src="img/icons/search.svg" />
				</div>
				<img src="img/icons/notification.svg" />
				<img src="img/icons/account.svg" />
			</div>

			<div class="dashboard-content">
				<div class="title">
					<h1>Dashboard</h1>
				</div>

				<div class="task-screen">
					<div class="task">
						<span>Running Project</span>
						<table class="styled-table">
							<tr>
								<td>Title</td>
								<td>Start date</td>
								<td>End date</td>
							</tr>
						</table>
						<table class="task-table" id="projects-table">
							<!-- Data will be inserted here by JavaScript -->
						</table>
					</div>

					<div class="add-project-form">
						<h2>Add New Project</h2>
						<form id="project-form" action="add_project.php" method="POST">
							<label for="project-title">Project Title:</label>
							<input type="text" id="project-title" name="project" required />

							<label for="start-date">Start Date:</label>
							<input type="date" id="start-date" name="start_date" required />

							<label for="end-date">End Date:</label>
							<input type="date" id="end-date" name="end_date" required />

							<button type="submit">Add Project</button>
						</form>
					</div>

					<div class="task2">
						<span>To do list</span>
						<div class="tickbox">
							<input type="checkbox" />
							Attend meeting
						</div>
						<div class="tickbox">
							<input type="checkbox" />
							Attend meeting
						</div>
						<div class="tickbox">
							<input type="checkbox" />
							Attend meeting
						</div>
						<div class="tickbox">
							<input type="checkbox" />
							Attend meeting
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			function loadProjects() {
				fetch("fetch_projects.php")
					.then((response) => response.json())
					.then((data) => {
						var table = document.getElementById("projects-table");
						table.innerHTML = ""; // Clear current rows

						data.forEach(function (project) {
							var row = table.insertRow();
							row.insertCell(0).textContent = project.project;
							row.insertCell(1).textContent = project.start_date;
							row.insertCell(2).textContent = project.end_date;

							// Create a delete button for each project row
							var deleteCell = row.insertCell(3);
							var deleteButton = document.createElement("button");
							deleteButton.textContent = "Delete";
							deleteButton.onclick = function () {
								deleteProject(project.id); // Pass the correct project ID here
							};
							deleteCell.appendChild(deleteButton);
						});
					})
					.catch((error) => console.error("Error:", error));
			}

			function deleteProject(projectId) {
				if (confirm("Are you sure you want to delete this project?")) {
					fetch("delete_project.php?id=" + projectId, {
						method: "GET",
					})
						.then((response) => response.text())
						.then((data) => {
							console.log(data); // Debug: log the response
							loadProjects(); // Reload projects after deletion
						})
						.catch((error) => console.error("Error:", error));
				}
			}
		</script>
	</body>
</html>
